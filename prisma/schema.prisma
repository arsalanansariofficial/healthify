generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum Gender {
  male
  female
}

enum RenewalType {
  yearly
  monthly
}

enum DispensaryStatus {
  dispensed
  prescribed
}

enum SubscriptionStatus {
  active
  pending
  cancelled
}

enum PaymentMethod {
  card
  cash
  wallet
  bank_transfer
}

enum AppointmentStatus {
  pending
  confirmed
  cancelled
  completed
}

enum PaymentStatus {
  failed
  pending
  refunded
  completed
}

enum Day {
  sunday
  monday
  friday
  tuesday
  thursday
  saturday
  wednesday
}

model DepartmentFacility {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  departmentId String @db.ObjectId
  facilityId   String @db.ObjectId

  facility   Facility   @relation(fields: [facilityId], references: [id], onDelete: Cascade)
  department Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)
}

model HospitalDepartment {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  departmentId String @db.ObjectId
  hospitalId   String @db.ObjectId

  hospital   Hospital   @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  department Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)
}

model HospitalMembership {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  hospitalId   String @db.ObjectId
  membershipId String @db.ObjectId

  hospital   Hospital   @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  membership Membership @relation(fields: [membershipId], references: [id], onDelete: Cascade)

  @@unique([hospitalId, membershipId])
}

model UserRole {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  userId String @db.ObjectId
  roleId String @db.ObjectId

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  role Role @relation(fields: [roleId], references: [id], onDelete: Cascade)
}

model UserSpeciality {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  userId       String @db.ObjectId
  specialityId String @db.ObjectId

  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  speciality Speciality @relation(fields: [specialityId], references: [id], onDelete: Cascade)
}

model RolePermission {
  id String @id @default(auto()) @map("_id") @db.ObjectId

  roleId       String @db.ObjectId
  permissionId String @db.ObjectId

  role       Role       @relation(fields: [roleId], references: [id], onDelete: Cascade)
  permission Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
}

model Speciality {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String   @unique
  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())

  userSpecialities UserSpeciality[]
}

model Permission {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String   @unique
  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())

  rolePermission RolePermission[]
}

model AppointmentHospital {
  id     String            @id @default(auto()) @map("_id") @db.ObjectId
  status AppointmentStatus @default(pending)

  appointmentId String @db.ObjectId
  hospitalId    String @db.ObjectId

  hospital    Hospital    @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  appointment Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
}

model Department {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())

  departmentFacilities DepartmentFacility[]
  hospitalDepartments  HospitalDepartment[]
}

model PharmaCode {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  frequency   Int
  code        String
  description String?
  updatedAt   DateTime @updatedAt
  createdAt   DateTime @default(now())
}

model PharmaManufacturer {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  description String?
  updatedAt   DateTime @updatedAt
  createdAt   DateTime @default(now())

  medicines Medicine[]
}

model PharmaBrand {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  description String?
  updatedAt   DateTime @updatedAt
  createdAt   DateTime @default(now())

  medicines Medicine[]
}

model PharmaSalt {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  description String?
  updatedAt   DateTime @updatedAt
  createdAt   DateTime @default(now())

  medicines Medicine[]
}

model MedicationForm {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  description String?
  updatedAt   DateTime @updatedAt
  createdAt   DateTime @default(now())

  medicines Medicine[]
}

model Role {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String   @unique
  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())

  UserRole        UserRole[]
  RolePermissions RolePermission[]
}

model Token {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  expires   DateTime
  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())

  userId String @unique @db.ObjectId

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Facility {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())

  appointmentId String? @db.ObjectId

  appointment Appointment? @relation(fields: [appointmentId], references: [id])

  departmentFacilities DepartmentFacility[]
}

model MembershipSubscription {
  id        String             @id @default(auto()) @map("_id") @db.ObjectId
  status    SubscriptionStatus @default(pending)
  updatedAt DateTime           @updatedAt
  createdAt DateTime           @default(now())

  feeId        String @db.ObjectId
  membershipId String @db.ObjectId
  userId       String @unique @db.ObjectId

  fee        Fee        @relation(fields: [feeId], references: [id], onDelete: Cascade)
  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  membership Membership @relation(fields: [membershipId], references: [id], onDelete: Cascade)

  transactions MembershipTransaction[]
}

model Fee {
  id          String      @id @default(auto()) @map("_id") @db.ObjectId
  renewalType RenewalType
  amount      Float?
  updatedAt   DateTime    @updatedAt
  createdAt   DateTime    @default(now())

  membershipId String @db.ObjectId

  membership Membership @relation(fields: [membershipId], references: [id], onDelete: Cascade)

  membershipSubscriptions MembershipSubscription[]
}

model TimeSlot {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  duration  Int
  time      String
  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())

  userId String? @db.ObjectId

  User        User?         @relation(fields: [userId], references: [id], onDelete: Cascade)
  Appointment Appointment[]
}

model Membership {
  id    String   @id @default(auto()) @map("_id") @db.ObjectId
  name  String
  perks String[]

  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())

  fees Fee[]

  hospitalMemberships     HospitalMembership[]
  membershipSubscriptions MembershipSubscription[]
}

model Prescription {
  id        String           @id @default(auto()) @map("_id") @db.ObjectId
  status    DispensaryStatus @default(prescribed)
  quantity  Float
  updatedAt DateTime         @updatedAt
  createdAt DateTime         @default(now())

  medicineId    String @db.ObjectId
  appointmentId String @db.ObjectId

  medicine    Medicine    @relation(fields: [medicineId], references: [id], onDelete: Cascade)
  appointment Appointment @relation(fields: [appointmentId], references: [id], onDelete: Cascade)
}

model MembershipTransaction {
  id        String         @id @default(auto()) @map("_id") @db.ObjectId
  amount    Float
  expiresAt DateTime?
  status    PaymentStatus
  method    PaymentMethod?
  updatedAt DateTime       @updatedAt
  createdAt DateTime       @default(now())

  subscriptionId String @db.ObjectId

  subscription MembershipSubscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)
}

model Hospital {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  name         String
  city         String
  address      String?
  email        String   @unique
  phone        String   @unique
  updatedAt    DateTime @updatedAt
  isAffiliated Boolean  @default(false)
  createdAt    DateTime @default(now())

  doctors              User[]
  medicines            Medicine[]
  hospitalDepartments  HospitalDepartment[]
  hospitalMemberships  HospitalMembership[]
  appointmentHospitals AppointmentHospital[]
}

model Benificiary {
  id        String    @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  relation  String
  image     String?
  cover     String?
  city      String?
  gender    Gender?
  idCards   String[]
  dob       DateTime?
  phone     String?   @unique
  updatedAt DateTime  @updatedAt
  createdAt DateTime  @default(now())

  sourceId String @db.ObjectId

  source User @relation(fields: [sourceId], references: [id], onDelete: Cascade)

  doctorAppointments Appointment[]
}

model Account {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  expires_at        Int?
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  updatedAt         DateTime @updatedAt
  createdAt         DateTime @default(now())

  userId String @db.ObjectId

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Medicine {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  quantity     Int
  bill         String
  billNumber   String
  name         String
  batchNumber  String
  description  String?
  expiryDate   DateTime
  purchaseDate DateTime
  updatedAt    DateTime @updatedAt
  createdAt    DateTime @default(now())

  saltId           String @db.ObjectId
  brandId          String @db.ObjectId
  hospitalId       String @db.ObjectId
  manufacturerId   String @db.ObjectId
  medicationFormId String @db.ObjectId

  salt           PharmaSalt         @relation(fields: [saltId], references: [id], onDelete: Cascade)
  brand          PharmaBrand        @relation(fields: [brandId], references: [id], onDelete: Cascade)
  hospital       Hospital           @relation(fields: [hospitalId], references: [id], onDelete: Cascade)
  manufacturer   PharmaManufacturer @relation(fields: [manufacturerId], references: [id], onDelete: Cascade)
  medicationForm MedicationForm     @relation(fields: [medicationFormId], references: [id], onDelete: Cascade)

  prescriptions Prescription[]
}

model Appointment {
  id         String            @id @default(auto()) @map("_id") @db.ObjectId
  name       String
  email      String
  phone      String
  city       String
  notes      String?
  reports    String[]
  date       DateTime
  updatedAt  DateTime          @updatedAt
  isReferred Boolean?          @default(false)
  createdAt  DateTime          @default(now())
  status     AppointmentStatus @default(pending)

  doctorId       String  @db.ObjectId
  patientId      String  @db.ObjectId
  timeSlotId     String  @db.ObjectId
  hospitalId     String? @db.ObjectId
  prescriptionId String? @db.ObjectId
  benificiaryId  String? @db.ObjectId

  timeSlot    TimeSlot     @relation(fields: [timeSlotId], references: [id], onDelete: Cascade)
  benificiary Benificiary? @relation(fields: [benificiaryId], references: [id], onDelete: Cascade)
  doctor      User         @relation("doctor", fields: [doctorId], references: [id], onDelete: Cascade)
  patient     User         @relation("patient", fields: [patientId], references: [id], onDelete: Cascade)

  facilities           Facility[]
  prescriptions        Prescription[]
  appointmentHospitals AppointmentHospital[]

  @@unique([patientId, benificiaryId, doctorId, date, timeSlotId])
}

model User {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  experience    Int?
  name          String?
  image         String?
  cover         String?
  password      String?
  city          String?
  gender        Gender?
  bio           String?
  phone         String?
  idCards       String[]
  emailVerified DateTime?
  email         String?   @unique
  updatedAt     DateTime  @updatedAt
  createdAt     DateTime  @default(now())
  hasOAuth      Boolean   @default(false)

  subscription   MembershipSubscription?
  subscriptionId String?                 @db.ObjectId

  hospitalId String?   @db.ObjectId
  hospital   Hospital? @relation(fields: [hospitalId], references: [id])

  daysOfVisit      Day[]
  token            Token?
  accounts         Account[]
  timings          TimeSlot[]
  UserRoles        UserRole[]
  benificiaries    Benificiary[]
  UserSpecialities UserSpeciality[]

  doctorAppointments  Appointment[] @relation("doctor")
  patientAppointments Appointment[] @relation("patient")
}
